# FVG Bot Trading Workflow

## Overview
This document explains how the FVG trading system works between the Python signal generator and NinjaTrader strategy.

## System Architecture

```
Python Bot (fvg_bot.py)
    ↓
Generates Signals → trade_signals.csv
    ↓
NinjaTrader Strategy (fvgbot.cs)
    ↓
Executes Trades → trades_taken.csv
```

## Files

### 1. trade_signals.csv
**Location:** `C:\Users\Joshua\Documents\Projects\FVG Bot\trade_signals.csv`

**Purpose:** Contains trade signals generated by the Python bot when FVG zones are detected.

**Format:**
```csv
DateTime,Signal,Direction,Entry_Price,Stop_Loss,Profit_Target,Zone_Type,ATR
11/10/2025 14:30:00,FVG_RETEST,LONG,5850.25,5845.00,5857.75,bearish,2.50
```

**Managed By:** Python bot (fvg_bot.py) - Cleared on startup, new signals appended

### 2. trades_taken.csv
**Location:** `C:\Users\Joshua\Documents\Projects\FVG Bot\trades_taken.csv`

**Purpose:** Logs all trades executed by NinjaTrader, including actual fill prices.

**Format:**
```csv
Entry_DateTime,Signal_DateTime,Signal_Type,Direction,Entry_Price,Stop_Loss,Profit_Target,Zone_Type,ATR,Actual_Entry_Price
11/10/2025 14:30:05,11/10/2025 14:30:00,FVG_RETEST,LONG,5850.25,5845.00,5857.75,bearish,2.50,5850.50
```

**Managed By:** NinjaTrader strategy (fvgbot.cs) - Preserves historical data

## Workflow Step-by-Step

### 1. Python Bot Detection
1. Monitors `data/HistoricalData.csv` for new hourly bars
2. Detects Fair Value Gaps (FVGs) in price action
3. Monitors `data/LiveFeed.csv` for real-time price
4. When price enters an FVG zone, generates a signal

### 2. Signal Generation
When triggered, Python bot writes to **both** files:
- `trade_signals.csv` - Fresh signal for NinjaTrader
- `trades_taken.csv` - Historical record of signal (Python side)

### 3. NinjaTrader Detection
1. Checks `trade_signals.csv` every 2 seconds (configurable)
2. Detects file modification
3. Reads the most recent signal
4. Validates signal hasn't been processed

### 4. Trade Execution
1. Places **market order** (not limit order at signal price)
2. Gets actual fill price from execution
3. Sets stop loss at `Stop_Loss` price
4. Sets profit target at `Profit_Target` price

### 5. Trade Logging
When order fills, NinjaTrader writes to `trades_taken.csv`:
- Entry_DateTime: Actual time order filled
- Signal_DateTime: When Python bot generated the signal
- Entry_Price: Original signal entry price
- Actual_Entry_Price: Real fill price from market

## Key Changes Made

### NinjaTrader Strategy (fvgbot.cs)

#### Added Variables
```csharp
private string tradesLogFilePath = @"C:\Users\Joshua\Documents\Projects\FVG Bot\trades_taken.csv";
private string signalType = "";
private string zoneType = "";
private double signalATR = 0;
private DateTime signalDateTime = DateTime.MinValue;
private DateTime entryTime = DateTime.MinValue;
private double actualEntryPrice = 0;
```

#### New Methods
1. **InitializeTradesLogFile()** - Creates trades_taken.csv with header if it doesn't exist
2. **LogTradeToFile()** - Writes trade details when order is filled

#### Modified Methods
1. **ProcessSignalLine()** - Now parses all CSV fields including Signal_Type, Zone_Type, and ATR
2. **ExecuteLongEntry() / ExecuteShortEntry()** - Changed from limit orders to market orders
3. **OnExecutionUpdate()** - Enhanced to capture actual fill price and log to CSV

#### Added Property
```csharp
[NinjaScriptProperty]
[Display(Name="Trades Log File Path", ...)]
public string TradesLogFilePath
```

## Trade Signal Flow

### Bullish FVG (Gap Up)
```
Price gaps up, leaving space below
Zone: Bottom (old high) → Top (new low)
Signal: SHORT when price re-enters zone
Target: Fill gap by reaching bottom
```

### Bearish FVG (Gap Down)
```
Price gaps down, leaving space above
Zone: Bottom (new high) → Top (old low)
Signal: LONG when price re-enters zone
Target: Fill gap by reaching top
```

## Configuration

### Python Bot Settings
```python
instrument = 'MES'
zone_cooldown_minutes = 60
min_profit_target_points = 5.0
```

### NinjaTrader Settings
- **Signals File Path**: `C:\Users\Joshua\Documents\Projects\FVG Bot\trade_signals.csv`
- **Trades Log File Path**: `C:\Users\Joshua\Documents\Projects\FVG Bot\trades_taken.csv`
- **File Check Interval**: 2 seconds

## Data Preservation

### trade_signals.csv
- **Cleared on Python bot startup** (prevents duplicate trades)
- Fresh signals only for current session

### trades_taken.csv
- **Preserved across sessions** (historical trade log)
- Never cleared automatically
- Append-only for audit trail

## Important Notes

1. **Market Orders**: Strategy uses market orders, not limit orders. Actual fill price may differ from signal price due to slippage.

2. **Signal Processing**: Each signal is processed only once using a unique ID (datetime + direction).

3. **Position Management**: Strategy will not take new signals while in an existing position.

4. **Zone Cooldown**: Python bot prevents trading the same zone within 60 minutes (configurable).

5. **File Monitoring**: NinjaTrader checks for file modifications every 2 seconds.

## Troubleshooting

### Strategy not taking trades
- Verify `trade_signals.csv` file path is correct
- Check NinjaTrader Output window for error messages
- Ensure strategy is enabled on the chart

### Duplicate trades
- Python bot clears `trade_signals.csv` on startup
- Check `processedSignals` HashSet is working

### Missing trade logs
- Verify `trades_taken.csv` file path is correct
- Check file permissions (read/write access)
- Look for error messages in NinjaTrader Output

## Example Trade Scenario

1. **10:00 AM** - Python bot detects bearish FVG (gap down)
   - Zone: 5845.00 - 5852.00

2. **10:30 AM** - Price rises into zone at 5848.50
   - Python writes signal to trade_signals.csv: LONG entry

3. **10:30:02 AM** - NinjaTrader detects new signal
   - Places market order to buy 1 contract

4. **10:30:03 AM** - Order fills at 5848.75
   - Sets stop loss at 5840.00
   - Sets profit target at 5852.00
   - Logs trade to trades_taken.csv with actual fill 5848.75

5. **10:45 AM** - Price reaches profit target at 5852.00
   - Exit logged, position closed
   - Profit: 3.25 points = $16.25 (MES)
